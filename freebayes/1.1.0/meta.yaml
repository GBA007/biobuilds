{% set version = "1.1.0" %}

package:
  name: freebayes
  version: "{{ version }}"

source:
  fn: "freebayes_full-{{ version }}.tar.bz2"
  url:
    # Use this tarball instead of upstream GitHub one since this one also
    # includes the source code for all the git submodules; this tarball was
    # generated by the "package-freebayes.sh" script provided in the recipe.
    - "http://download.lab7.io/sources/freebayes_full-{{ version }}.tar.bz2"
  sha1: "41ab7813bdf049ac4691266dab300ed286a4c91a"
  patches:
    - flags-libs.patch
    - script-paths.patch
    - osx-tests.patch         # [osx]
    - ppc64le-support.patch   # [ppc64le]

requirements:
  build:
    - biobuilds-build
    - veclib-headers    # [ppc64le]
    - perl
    - zlib
    # Need updated GNU assembler when `icc`/`icpc`, or the build process will
    # choke on AVX2 instructions like 'vpxor', 'vpaddd', 'vinserti128', etc.
    - binutils          # [opt and linux64]
    # Only needed at build time since we statically link these libraries
    - bwa
    - bamtools
    - vcflib
    # Only needed at build time for "make test"
    - samtools
    - parallel
  run:
    - biobuilds-opt     # [opt]
    - perl
    - python
    - zlib

build:
  number: 1
  features:
    - opt     # [opt]
  script_env:
    - MAKE_JOBS

test:
  commands:
    - freebayes -h
    - bamleftalign -h
    - "test \"`freebayes --version | awk '{print $2;}'`\" = 'v{{ version }}'"

about:
  home: "https://github.com/ekg/freebayes"
  license: MIT
  license_file: LICENSE
  summary: "Bayesian, haplotype-based, genetic variant detector designed to find small polymorphisms"
